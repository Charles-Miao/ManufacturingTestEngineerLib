```mermaid
graph TD;
    classDef startend fill:#F5EBFF,stroke:#BE8FED,stroke-width:2px;
    classDef process fill:#E5F6FF,stroke:#73A6FF,stroke-width:2px;
    classDef decision fill:#FFF6CC,stroke:#FFBC52,stroke-width:2px;
    classDef io fill:#FFEBEB,stroke:#E68994,stroke-width:2px;
    
    A([开始]):::startend --> B(初始化参数):::process;
    B --> C(显示测试项名称):::process;
    C --> D{检查 AC 状态}:::decision;
    D -- 异常 --> E(设置测试状态为失败):::process;
    E --> F(发送错误消息):::process;
    F --> G(跳转到测试结束):::process;
    D -- 正常 --> H{是否离线}:::decision;
    H -- 是 --> I(设置测试状态为通过):::process;
    I --> J(发送调试消息):::process;
    J --> G;
    H -- 否 --> K(获取电池电量百分比):::process;
    K --> L(发送电池电量信息):::process;
    L --> M{电池电量 < 31%}:::decision;
    M -- 是 --> N(退出所有测试模式):::process;
    N --> O(休眠 5 秒):::process;
    O --> P(循环检查电池电量):::process;
    P --> Q(设置电池浮动模式和限制):::process;
    M -- 否 --> Q;
    Q --> R{工厂模式是否开启}:::decision;
    R -- 否 --> S(尝试开启工厂模式):::process;
    S --> T{开启是否成功}:::decision;
    T -- 失败 --> U(设置测试状态为失败):::process;
    U --> V(发送错误消息):::process;
    V --> G;
    R -- 是 --> W(发送工厂模式开启消息):::process;
    T -- 成功 --> W;
    W --> X(获取本地 BIOS 版本):::process;
    X --> Y(发送 MES BIOS 版本信息):::process;
    Y --> Z{MES BIOS 版本是否为空}:::decision;
    Z -- 是 --> AA(设置测试状态为失败):::process;
    AA --> AB(发送错误消息):::process;
    AB --> AC(保存测试次数为 0):::process;
    AC --> G;
    Z -- 否 --> AD(检查刷写次数文件):::process;
    AD --> AE(删除自动运行配置):::process;
    AE --> AF(发送总循环次数信息):::process;
    AF --> AG{刷写次数文件是否存在}:::decision;
    AG -- 是 --> AH(读取当前循环次数):::process;
    AH --> AI(发送当前循环次数信息):::process;
    AI --> AJ(保存当前循环次数 + 1):::process;
    AG -- 否 --> AJ;
    AJ --> AK{当前循环次数 > 总循环次数}:::decision;
    AK -- 是 --> AL{MES 和本地 BIOS 版本是否一致}:::decision;
    AL -- 是 --> AM(发送刷写成功消息):::process;
    AM --> AN(保存测试次数为 0):::process;
    AN --> AO(设置测试状态为通过):::process;
    AO --> G;
    AL -- 否 --> AP(发送刷写失败消息):::process;
    AP --> AN;
    AK -- 否 --> AQ{MES 和本地 BIOS 版本一致且不强制更新}:::decision;
    AQ -- 是 --> AR(发送无需更新消息):::process;
    AR --> AN;
    AQ -- 否 --> AS(尝试下载 BIOS 文件):::process;
    AS --> AT{下载是否成功}:::decision;
    AT -- 否 --> AU(设置测试状态为失败):::process;
    AU --> AV(发送下载失败消息):::process;
    AV --> AC;
    AT -- 是 --> AW(查找 BIOS 执行文件):::process;
    AW --> AX{是否找到匹配文件}:::decision;
    AX -- 否 --> AY(设置测试状态为失败):::process;
    AY --> AZ(发送错误消息):::process;
    AZ --> AC;
    AX -- 是 --> BA(设置自动运行配置):::process;
    BA --> BB{设置是否成功}:::decision;
    BB -- 否 --> BC(设置测试状态为失败):::process;
    BC --> BD(发送错误消息):::process;
    BD --> G;
    BB -- 是 --> BE(执行 BIOS 解锁操作):::process;
    BE --> BF(休眠 2 秒):::process;
    BF --> BG(启动 BIOS 刷写程序):::process;
    BG --> BH(发送刷写开始消息):::process;
    BH --> BI(休眠 6 分钟):::process;
    BI --> BJ(退出程序):::process;
    G --> BK(退出所有测试模式):::process;
    BK --> BL(设置电池浮动模式和限制):::process;
    BL --> BM(禁用 lid):::process;
    BM --> BN(添加测试项结果):::process;
    BN --> BO(返回测试结果):::process;
    BO --> BP([结束]):::startend;